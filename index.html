<!DOCTYPE html>
<html>
<head>
    <!-- Embed -->
    <title>Squishy Site</title>
    <meta property="og:title" content="Squishy Site">
    <meta property="og:description" content='Squishy T. "Madeline" Server, Codering Lady at Large'>
    <!-- 
    <link rel="icon" type="image/x-icon" href="images/icons/hat-logo.png">
    <meta property="og:image" content="https://squishy6094.github.io/images/icons/hat-logo.png">
    -->
    <style>
        body {
            background-color: #000;
        }
    </style>
</head>

<script type="text/javascript" src="djui-js/djui.js"></script>
<script type="text/javascript">

    // Utilities
    function lerp(a, b, alpha) {
        return a + alpha * ( b - a )
    }

    function clamp(value, min, max) {
        return Math.max(min, Math.min(max, value))
    }

    function remap(a, b, c, d, x) {
        return c + (d - c) * ((x - a) / (b - a))
    }

    function random(a, b) {
        return remap(0, 1, a, b, Math.random())
    }


    
    // Grab External Data
    function get_current_time_string() {
        const now = new Date();

        const isOddSecond = now.getSeconds() % 2 === 1;
        const separator = isOddSecond ? ' ' : ':'; // space on odd seconds, colon on even

        // Get hours and minutes for PST
        const pstOptions = {
            timeZone: 'America/Los_Angeles',
            hour: '2-digit',
            minute: '2-digit',
            hour12: false
        };
        const pstParts = new Intl.DateTimeFormat('en-US', pstOptions).formatToParts(now);
        const hour = pstParts.find(p => p.type === 'hour').value;
        const minute = pstParts.find(p => p.type === 'minute').value;

        const formattedPST = `${hour}${separator}${minute}`;

        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');

        return `${month}/${day} - ${formattedPST} PST`;
    }

    let discordInfo = "Discord"
    async function load_discord_data() {
        const guildId = '1137469863741362297';
        const res = await fetch(`https://discord.com/api/guilds/${guildId}/widget.json`);
        if (!res.ok) {
            return;
        }

        const data = await res.json();

        discordInfo = data.name + " - " + data.presence_count + " Online"
    }
    
    load_discord_data()

    let commitRate = "?";
    async function load_github_commit_rate(username, days = 30, token = null) {
        const since = new Date(Date.now() - days * 86400000).toISOString().split('T')[0];
        const url = `https://api.github.com/search/commits?q=author:${username}+committer-date:>=${since}`;

        const headers = {
            Accept: "application/vnd.github.cloak-preview" // Required for commit search
        };

        if (token) {
            headers.Authorization = `Bearer ${token}`;
        }

        const res = await fetch(url, { headers });
        const data = await res.json();

        if (!res.ok || !data.total_count) {
            console.error(data);
            return "Error or no commits found.";
        }

        const weeks = days / 7;
        commitRate = (data.total_count / weeks).toFixed(2); // average commits per week
    }
    load_github_commit_rate("Squishy6094")

    let personalMessageCooldown = 0;
    async function send_webhook_message(message) {
        // Always try to send, backend will enforce cooldown
        const response = await fetch("https://squishy-site-backend.vercel.app/api/send-discord", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message })
        });

        const data = await response.json();

        if (response.ok && !data.error) {
            console.log("Message sent!");
            djui_hud_text_input_state.success = true;
            // Set new cooldown for 15 minutes from now
            personalMessageCooldown = Date.now() + 15 * 60 * 1000;
        } else if (data && data.cooldown) {
            // Backend returned cooldown, set it
            personalMessageCooldown = data.cooldown;
            djui_hud_text_input_state.success = false;
            console.log("Cooldown active, cannot send message until:", new Date(personalMessageCooldown).toLocaleTimeString());
        } else {
            console.error("Failed to send:", data && data.error ? data.error : await response.text());
            djui_hud_text_input_state.success = false;
        }
    }

    // Helper Functions
    function djui_hud_render_slider(sliderPos, x, y, width, height) {
        let mouseX = djui_hud_get_mouse_x()
        let mouseY = djui_hud_get_mouse_y()

        djui_hud_set_color(255, 255, 255, 255)
        djui_hud_render_rect(x, y, width, 1)
        djui_hud_render_rect(x, y + height - 1, width, 1)
        djui_hud_render_rect(x, y, 1, height)
        djui_hud_render_rect(x + width - 1, y, 1, height)

        djui_hud_render_rect(x + 2, y + 2, (width - 4)*sliderPos, height - 4)
        
        if ((mouseX > x && mouseX < x + width) && (mouseY > y && mouseY < y + height)) {
            if (djui_hud_get_mouse_buttons_down() & L_MOUSE_BUTTON) {
                sliderPos = (mouseX - (x + 2))/(width - 4)
                sliderPos = clamp(sliderPos, 0, 1)
            }
        }
        return sliderPos
    }

    // Simple text input field for djui_hud
    let djui_hud_text_input_state = {
        active: false,
        value: "",
        cursor: 0,
        sent: false,
        success: null,
        lastFrameActive: false
    };

    function djui_hud_render_text_input(textValue, x, y, width, height) {
        let mouseX = djui_hud_get_mouse_x();
        let mouseY = djui_hud_get_mouse_y();
        let isInside = (mouseX > x && mouseX < x + width) && (mouseY > y && mouseY < y + height);

        // Draw box
        width = Math.max(width, djui_hud_measure_text(textValue) * 0.3 + 8);
        djui_hud_set_color(255, 255, 255, 255);
        djui_hud_render_rect(x, y, width, height);

        // Draw text
        djui_hud_set_color(0, 0, 0, 255);
        let textY = y + (height/2) - 3;
        djui_hud_print_text(textValue, x + 4, textY, 0.3);

        // Handle focus
        if (isInside && djui_hud_get_mouse_buttons_released() & L_MOUSE_BUTTON) {
            djui_hud_text_input_state.active = true;
            djui_hud_text_input_state.value = textValue;
            djui_hud_text_input_state.cursor = textValue.length;
        } else if (!isInside && djui_hud_get_mouse_buttons_released() & L_MOUSE_BUTTON) {
            djui_hud_text_input_state.active = false;
        }

        // Handle input
        if (djui_hud_text_input_state.active) {
            // Draw cursor
            let cursorX = x + 4 + djui_hud_measure_text(textValue.substring(0, djui_hud_text_input_state.cursor)) * 0.3;
            if ((globalTimer % 60) < 30) {
                djui_hud_set_color(0, 0, 0, 255);
                djui_hud_print_text("|", cursorX, textY, 0.3);
            }

            // Only attach event once per frame
            if (!djui_hud_text_input_state.lastFrameActive) {
                window.addEventListener('keydown', djui_hud_text_input_keydown);
            }
        } else {
            if (djui_hud_text_input_state.lastFrameActive) {
                window.removeEventListener('keydown', djui_hud_text_input_keydown);
            }
        }
        djui_hud_text_input_state.lastFrameActive = djui_hud_text_input_state.active;

        // Return the possibly updated value
        return djui_hud_text_input_state.active ? djui_hud_text_input_state.value : textValue;
    }

    function djui_hud_text_input_keydown(e) {
        if (!djui_hud_text_input_state.active) return;
        // Prevent input if message was sent (value is empty and not active)

        let val = djui_hud_text_input_state.value;
        let cur = djui_hud_text_input_state.cursor;
        if (e.key.length === 1 && val.length < 64) {
            val = val.slice(0, cur) + e.key + val.slice(cur);
            cur++;
        } else if (e.key === "Backspace" && cur > 0) {
            val = val.slice(0, cur - 1) + val.slice(cur);
            cur--;
        } else if (e.key === "Delete" && cur < val.length) {
            val = val.slice(0, cur) + val.slice(cur + 1);
        } else if (e.key === "ArrowLeft" && cur > 0) {
            cur--;
        } else if (e.key === "ArrowRight" && cur < val.length) {
            cur++;
        } else if (e.key === "Enter") {
            if (personalMessageCooldown - Date.now() > 0) return;
            djui_hud_text_input_state.active = false;
            send_webhook_message(djui_hud_text_input_state.value);
            djui_hud_text_input_state.sent = true;
        }
        djui_hud_text_input_state.value = val;
        djui_hud_text_input_state.cursor = cur;
        e.preventDefault();
    }

    let rainbowColor = { r: 255, g: 0, b: 0 }
    let rainbowState = 0
    function rainbow_color() {
        const speed = 5

        switch (rainbowState) {
            case 0:
                rainbowColor.r += speed
                if (rainbowColor.r >= 255) rainbowState++
                break
            case 1:
                rainbowColor.b -= speed
                if (rainbowColor.b <= 0) rainbowState++
                break
            case 2:
                rainbowColor.g += speed
                if (rainbowColor.g >= 255) rainbowState++
                break
            case 3:
                rainbowColor.r -= speed
                if (rainbowColor.r <= 0) rainbowState++
                break
            case 4:
                rainbowColor.b += speed
                if (rainbowColor.b >= 255) rainbowState++
                break
            case 5:
                rainbowColor.g -= speed
                if (rainbowColor.g <= 0) rainbowState = 0
                break
        }

        rainbowColor.r = clamp(rainbowColor.r, 0, 255)
        rainbowColor.g = clamp(rainbowColor.g, 0, 255)
        rainbowColor.b = clamp(rainbowColor.b, 0, 255)

        return {
            r: rainbowColor.r*0.6,
            g: rainbowColor.g*0.6,
            b: rainbowColor.b*0.6
        }
    }

    // Website
    let globalTimer = 0

    let TEXT_WEBSITE_NAME = "Squishy Site"
    let TEXT_WIP = "Nastywerkkk in Progress!!"
    let TEXT_CLICK_ANYWHERE = "Click Anywhere"

    // Music
    const musicTracks = [
        { name: "Team Fortress 2 - Upgrade Station", artist: "Value Inc.",              audio: 'sound/tf2-upgrade-station.ogg' },
        { name: "Portal - Radio Tune",               artist: "Value Inc.",              audio: 'sound/portal-radio.ogg' },
        { name: "Nintendo 3DS - Internet Settings",  artist: "Nintendo / BedrockSolid", audio: 'sound/3ds-internet-settings.ogg' },
        { name: "SM64CoopDX - Kindness Luigi",       artist: "foxwithguns2 / Gorillaz", audio: 'sound/music-kindness-luigi.ogg' },
        { name: "Sonic Unleashed - Windmill Isle (Night)",       artist: "Sonic Team", audio: 'sound/music-windmill-isle-night.ogg' },
        // Gay People, 10 am!
        { name: "Deltarune - Hip Shop",              artist: "Toby Fox",                audio: 'sound/music-hip-shop.ogg' },
        { name: "Undertale - Him",                   artist: "Toby Fox",                audio: 'sound/music-him.ogg'},
    ]

    const currMusicTrack = musicTracks[Math.floor(Math.random()*musicTracks.length)]
    const SOUND_MUSIC = new Audio(currMusicTrack.audio)
    SOUND_MUSIC.loop = true
    SOUND_MUSIC.preservesPitch = false
    SOUND_MUSIC.volume = 0.2

    console.log("Music Track: " + currMusicTrack.name + " | " + currMusicTrack.artist)

    // Sounds
    const SOUND_CHECKPOINT = new Audio('sound/Checkpoint.ogg')
    SOUND_CHECKPOINT.volume=0.5
    const SOUND_WOODBLOCK_OPEN = new Audio('sound/woodblock-open.ogg')
    const SOUND_WOODBLOCK_CLOSE = new Audio('sound/woodblock-close.ogg')
    const SOUND_WOODBLOCK_SWITCH = new Audio('sound/woodblock-switch.ogg')

    const shatterSounds = [
        'smw',
        'glass',
        'lego',
    ]
    const SOUND_SHATTER = new Audio('sound/shatter-' + shatterSounds[Math.floor(Math.random()*shatterSounds.length)] + '.mp3')

    const TEX_LOGO = get_texture_info("textures/wip-logo.png")
    const TEX_MUSIC_RECORD = get_texture_info("textures/record.png")
    const TEX_SQUISHY_PFP = get_texture_info("https://avatars.githubusercontent.com/u/74333752")
    const logoScale = 1.5

    let konamiKeys = []

    function konami_keys_check_pass(string) {
        let stringArray = Array.from(string)
        for (let i = 0; i < stringArray.length; i++) {
            if (stringArray[i] != konamiKeys[konamiKeys.length - stringArray.length + i]) {
                return false
            }
        }
        return true
    }

    const socialScaleMin = 0.3*4
    const socialScaleMax = 0.35*4
    const socialLinks = [
        { image: "github",     name: "Github",  color: { r: 100, g: 100, b: 100 }, link: "https://github.com/Squishy6094"                 },
        { image: "discord",    name: "Discord", color: { r:  88, g: 101, b: 242 }, link: "https://discord.gg/yN3ahrf5zD"                  },
        { image: "bsky",       name: "Bluesky", color: { r:  79, g: 155, b: 217 }, link: "https://bsky.app/profile/squishy6094.github.io" },
        { image: "twitter",    name: "Twitter", color: { r:  30, g:  30, b:  30 }, link: "https://x.com/squishy6094"                      },
        { image: "youtube",    name: "Youtube", color: { r: 200, g:   0, b:   0 }, link: "https://www.youtube.com/@Squishy6094"           },
        { image: "romhacking", name: "Romhacking.com", color: rainbow_color,       link: "https://romhacking.com/user/SQUISHY"            },
    ]
    for (let i in socialLinks) {
        socialLinks[i].image = get_texture_info("textures/social-" + socialLinks[i].image + ".png")
        socialLinks[i].y = 300
        socialLinks[i].scale = socialScaleMin
    }

    // Info Tabs Info??

    const currAge = new Date().getFullYear() - 2007 - (
        new Date() < new Date(new Date().getFullYear(), 3, 3) ? 1 : 0
    );
    let personalMessage = ""
    function info_tab_render_about_me(x, y, width, height) {
        // Profile Picture
        djui_hud_set_color(bgColor.r, bgColor.g, bgColor.b, 255)
        djui_hud_render_rect(x + 5, y + 3, 75, 75)
        djui_hud_set_color(255, 255, 255, 255)
        djui_hud_render_texture(TEX_SQUISHY_PFP, x + 7, y + 5, 71/TEX_SQUISHY_PFP.width, 71/TEX_SQUISHY_PFP.height)

        // Description
        djui_hud_print_text("Haii, I'm Squishy!", x + 85, y + 5, 0.5)
        let textY = y + 20
        djui_hud_print_text("I'm also known as Madeline, I'm a programmer who mainly", x + 85, textY, 0.3)
        textY = textY + 10
        djui_hud_print_text("works on SM64CoopDX Mods and Frontend Web Development!", x + 85, textY, 0.3)
        textY = textY + 10
        djui_hud_print_text("I'm generally just a silly gal looking for stuff to program,", x + 85, textY, 0.3)
        textY = textY + 10
        djui_hud_print_text("and I'm always up to learn new Scripting Languages", x + 85, textY, 0.3)
        textY = textY + 15
        djui_hud_print_text("My currently known Scripting Languages are:", x + 85, textY, 0.3)
        textY = textY + 10
        djui_hud_print_text("- Lua", x + 90, textY, 0.3)
        textY = textY + 10
        djui_hud_print_text("- Python", x + 90, textY, 0.3)
        textY = textY + 10
        djui_hud_print_text("- Javascript, CSS, Html", x + 90, textY, 0.3)

        // Basic Info
        textY = y + 80
        djui_hud_print_text("She/Her - Transgender Female", x + 6, textY, 0.25)
        textY = textY + 8
        djui_hud_print_text("Age: " + currAge, x + 6, textY, 0.25)
        textY = textY + 8
        djui_hud_print_text("Commit Rate: " + commitRate + "/Weekly", x + 6, textY, 0.25)

        let messageStatus = `${personalMessage.length}/64`;
        if (djui_hud_text_input_state.sent) {
            messageStatus = "Sending..."
            if (djui_hud_text_input_state.success) {
                messageStatus = "Sent!"
            } else if (djui_hud_text_input_state.success === false) {
                if (personalMessageCooldown > Date.now()) {
                    let msLeft = personalMessageCooldown - Date.now();
                    let min = Math.floor(msLeft / 60000);
                    let sec = Math.floor((msLeft % 60000) / 1000);
                    let secStr = sec < 10 ? "0" + sec : sec;
                    messageStatus = `Cooldown ${min}:${secStr}`;
                } else {
                    messageStatus = "Failed to Send"
                }
            }
        }

        djui_hud_set_color(255, 255, 255, 255)
        djui_hud_print_text("Send me a Message!! - " + messageStatus, x + 10, y + 140, 0.3)
        personalMessage = djui_hud_render_text_input(personalMessage, x + 10, y + 148, 100, 15);
        djui_hud_set_color(255, 255, 255, 150)
        djui_hud_print_text("(Messages are publicly viewable but anonymous)", x + 10, y + 165, 0.2)
    }
    
    let optionMusicVolume = localStorage.getItem("musicVolume") ? localStorage.getItem("musicVolume") : 0.25
    let optionMusicSpeed = localStorage.getItem("musicSpeed") ? localStorage.getItem("musicSpeed") : 0.5
    function info_tab_render_options(x, y, width, height) {
        
        djui_hud_print_text("Music Volume: ", x + 10, y + 10, 0.4)
        optionMusicVolume = djui_hud_render_slider(optionMusicVolume, x + 70, y + 9, 100, 10)
        djui_hud_print_text(Math.round(optionMusicVolume*100) + "%", x + 180, y + 10, 0.4)
        if (globalTimer % 30 == 1) {
            localStorage.setItem("musicVolume", optionMusicVolume)
        }

        djui_hud_print_text("Music Speed: ", x + 10, y + 25, 0.4)
        optionMusicSpeed = djui_hud_render_slider(optionMusicSpeed, x + 70, y + 24, 100, 10)
        djui_hud_print_text("x" + Math.round((0.8 + optionMusicSpeed*0.4)*100)/100, x + 180, y + 25, 0.4)
        if (globalTimer % 30 == 1) {
            localStorage.setItem("musicSpeed", optionMusicSpeed)
        }
    }

    let currInfoTab = 0
    let prevInfoTab = 1
    let infoTabPosX = 0
    const infoTabs = [
        {image: get_texture_info("textures/squishy-about-me.png"), name: "About Me", func: info_tab_render_about_me},
        {image: null,                                              name: "Options", func: info_tab_render_options},
    ]
    for (let i in infoTabs) {
        infoTabs[i].x = -80 - 5*(i + 1)
    }

    djui_hud_set_resolution(RESOLUTION_N64)

    let bgColorDefault = { r: 0, g: 88, b: 0 }
    let bgColorRaw = bgColorDefault
    let bgColor = bgColorRaw
    let bgCheckerSize = 16
    let titleClick = false
    let keyTitleClick = false
    let titleOffset = djui_hud_get_screen_width()*0.25
    let titleScaleSpin = 2
    let logoFallPosY = djui_hud_get_screen_height()
    let logoFallVelY = 0
    let logoFlash = 0

    let recordSpeed = 0x10 // fullrev   fps  s/m  rpm
    const recordSpeedTarget = 0x10000 / 60 / 60 * 33
    const recordSpeedUp = 10
    const recordSlowDown = 10
    const recordBrake = 40
    const recordBreakThreshold = 3500
    let recordRot = 0
    let recordDragStart = 0
    let recordHeld = false

    let recordBreakTimer = 0
    let recordBreakSpin = 0
    let recordBroken = false
    let recordPos = { x: 0, y: 0 }
    let recordVel = { x: 0, y: 0 }
    let musicTitlePos = { x: 0, y: 0 }
    let musicTitleVel = { x: 0, y: 0 }
    let musicArtistPos = { x: 0, y: 0 }
    let musicArtistVel = { x: 0, y: 0 }

    function hud_render() {
        djui_hud_set_resolution(RESOLUTION_N64)
        let screenWidth = djui_hud_get_screen_width()
        let screenHeight = djui_hud_get_screen_height()

        // Set User Settings
        SOUND_MUSIC.volume = 0.2*optionMusicVolume

        // Background Color
        let prevColor = (typeof bgColorRaw === 'function' ? bgColorRaw() : bgColorRaw)
        bgColor.r = lerp(bgColor.r, prevColor.r, 0.1)
        bgColor.g = lerp(bgColor.g, prevColor.g, 0.1)
        bgColor.b = lerp(bgColor.b, prevColor.b, 0.1)
        djui_hud_set_color(bgColor.r, bgColor.g, bgColor.b, 255)
        djui_hud_render_rect(0, 0, screenWidth, screenHeight)
        djui_hud_set_color(bgColor.r*0.5, bgColor.g*0.5, bgColor.b*0.5, 255)
        let checkerWidth = Math.ceil(screenWidth / bgCheckerSize) + 1
        let checkerHeight = Math.ceil(screenHeight / bgCheckerSize) + 1
        for (let w = 0; w < checkerWidth; w++) {
            for (let h = 0; h < checkerHeight; h++) {
                if ((w+h) % 2) {
                    djui_hud_render_rect((w - 1) * bgCheckerSize, (h - 1) * bgCheckerSize, bgCheckerSize, bgCheckerSize)
                }
            }
        }
        
        djui_hud_set_color(0, 0, 0, logoFlash)
        djui_hud_render_rect(0, 0, screenWidth, screenHeight)

        // Title Screen
        logoFallVelY -= 0.3
        logoFallPosY += logoFallVelY
        if (logoFallPosY < 0) {
            logoFallVelY = -logoFallVelY*0.5
            logoFallPosY = 0
        }
        let logoTilt = Math.sin(globalTimer*0.1)/Math.PI*0x800
        djui_hud_set_color(255, 255, 255, 255)
        djui_hud_set_rotation(logoTilt, 0.5, 0.5)
        let spinMath = (Math.sin((titleScaleSpin + 0.5)*Math.PI))
        djui_hud_render_texture(TEX_LOGO, screenWidth*0.25 + titleOffset - TEX_LOGO.width*logoScale*0.5 * spinMath, screenHeight*0.5 - TEX_LOGO.height*logoScale*0.5 - (Math.sin((titleOffset/(screenWidth*0.25))*Math.PI)*30) - logoFallPosY, logoScale * spinMath, logoScale)
        djui_hud_set_rotation(0, 0, 0)
        if ((djui_hud_get_mouse_buttons_released() || keyTitleClick) && !titleClick) {
            // Initialize like EVERYTHINGG
            titleClick = true
            SOUND_CHECKPOINT.play()
            SOUND_MUSIC.play()
            logoFlash = 150

            if (konami_keys_check_pass("7")) {
                TEXT_WIP = "KILLER7"
            }
            if (konami_keys_check_pass("iloveyou")) {
                window.open("https://raw.githubusercontent.com/Squishy6094/squishy6094.github.io/refs/heads/main/textures/squishy-iloveyoutoo.png", "_blank", "width=200, height=200");
            }
            if (konami_keys_check_pass("shell")) {
                bgColorRaw = {r:107, g:94, b:255}
            }
            if (konami_keys_check_pass("kys")) {
                recordSpeed = recordBreakThreshold*2
            }
        }

        let mouseX = djui_hud_get_mouse_x()
        let mouseY = djui_hud_get_mouse_y()

        djui_hud_set_color(0, 0, 0, 100)
        djui_hud_render_rect(screenWidth*0.25 - socialLinks.length*0.5*16*socialScaleMax+2 - 5, screenHeight - 35 + socialLinks[1].y, socialLinks.length*16*socialScaleMax+2 + 5, 28)
        if (titleClick) {
            // Bottom Socials
            for (let i in socialLinks) {
                // Ensure images, no matter res, become the right size
                socialLinks[i].scaleAdjust = 16/socialLinks[i].image.width

                // Update Discord Name
                if (socialLinks[i].name == "Discord" && discordInfo != "Discord") {
                    socialLinks[i].name = discordInfo
                }

                socialLinks[i].y *= 0.85 + (i*0.09/socialLinks.length)
                let imgWidth = socialLinks[i].image.width * socialLinks[i].scaleAdjust
                let imgHeight = socialLinks[i].image.height * socialLinks[i].scaleAdjust
                let imgScale = socialLinks[i].scale * socialLinks[i].scaleAdjust
                let x = (i - socialLinks.length*0.5)*imgWidth*socialScaleMax+2 + screenWidth*0.25
                let y = screenHeight - 30 + socialLinks[i].y
                djui_hud_set_color(255, 255, 255, 255)
                
                let imgScaleOffset = -imgWidth*socialScaleMin*0.5 + (imgWidth*socialScaleMin*(socialLinks[i].scale/socialScaleMin))*0.5
                djui_hud_render_texture(socialLinks[i].image, x - imgScaleOffset, y - imgScaleOffset, imgScale, imgScale)

                let textOpacity = 0
                if (currInfoTab == 0 && (mouseX > x && mouseX < x + imgWidth*socialLinks[i].scale) && (mouseY > y && mouseY < y + imgWidth*socialLinks[i].scale)) {
                    if (djui_hud_get_mouse_buttons_released() & L_MOUSE_BUTTON) {
                        window.open(socialLinks[i].link)
                    }
                    socialLinks[i].scale = Math.min(socialLinks[i].scale*1.05, socialScaleMax)
                    bgColorRaw = socialLinks[i].color
                } else {
                    socialLinks[i].scale = Math.max(socialLinks[i].scale*0.95, socialScaleMin)
                }
                djui_hud_set_color(255, 255, 255, (socialLinks[i].scale-socialScaleMin)/(socialScaleMax-socialScaleMin)*255)
                djui_hud_print_text(socialLinks[i].name, (x + imgWidth*socialScaleMin*0.5) - djui_hud_measure_text(socialLinks[i].name)*0.15, y - 10, 0.3)
            }
            titleOffset *= 0.9
            titleScaleSpin *= 0.9
            logoFlash *= 0.9
            
            // Info Tabs
            let tabY = 15
            for (let i in infoTabs) {
                i = Number(i)
                let x = screenWidth - 50 - infoTabPosX - infoTabs[i].x
                let y = tabY
                let tabHeight = 60
                if (infoTabs[i].image == null) {
                    tabHeight = 15
                }

                djui_hud_set_color(0, 0, 0, 150)
                djui_hud_render_rect(x, y, 50 + infoTabs[i].x, tabHeight)
                djui_hud_set_color(255, 255, 255, 255)
                if (infoTabs[i].image != null) {
                djui_hud_render_texture(infoTabs[i].image, x + 2, y + 2, 46/infoTabs[i].image.width, 46/infoTabs[i].image.width)
                }
                djui_hud_print_text(infoTabs[i].name, x + 25 - djui_hud_measure_text(infoTabs[i].name)*0.15, y + tabHeight - 10, 0.3)
                tabY = tabY + tabHeight + 5
                
                if ((mouseX > x && mouseX < x + 50 + infoTabs[i].x) && (mouseY > y && mouseY < y + tabHeight)) {
                    if (djui_hud_get_mouse_buttons_released() & L_MOUSE_BUTTON) {
                        if (currInfoTab != i + 1) {
                            if (currInfoTab == 0) {
                                SOUND_WOODBLOCK_OPEN.play()
                            } else {
                                SOUND_WOODBLOCK_SWITCH.currentTime = 0
                                SOUND_WOODBLOCK_SWITCH.play()
                            }
                            currInfoTab = i + 1
                        } else {
                            currInfoTab = 0
                            SOUND_WOODBLOCK_CLOSE.play()
                        }
                    }
                    infoTabs[i].x = lerp(infoTabs[i].x, 6, 0.1)
                } else {
                    infoTabs[i].x = lerp(infoTabs[i].x, (currInfoTab == i + 1) ? 3 : 0, 0.1)
                }
            }

            if (infoTabPosX != 0) {
                djui_hud_set_color(0, 0, 0, 150)
                djui_hud_render_rect(screenWidth - infoTabPosX, 0, screenWidth, screenHeight)
                djui_hud_set_color(0, 0, 0, 255)
                djui_hud_render_rect(screenWidth - infoTabPosX, 0, screenWidth, 20)
                djui_hud_render_rect(screenWidth - infoTabPosX, 0, 3, screenHeight)
                djui_hud_set_color(255, 255, 255, 255)
                djui_hud_print_text(infoTabs[prevInfoTab - 1].name, screenWidth - infoTabPosX + 6, 4, 0.6)
                infoTabs[prevInfoTab - 1].func(screenWidth - infoTabPosX, 20, screenWidth - infoTabPosX)
            }

            if (currInfoTab != 0) {
                infoTabPosX = lerp(infoTabPosX, screenWidth - 60, 0.15)
                if (infoTabs[currInfoTab - 1] != null) {
                    prevInfoTab = currInfoTab
                } else {
                    currInfoTab = 0
                }
            } else {
                infoTabPosX = lerp(infoTabPosX, 0, 0.15)
            }

            // Music Record
            if (!recordBroken) {
                let userSpeedTarget = recordSpeedTarget * (0.8 + optionMusicSpeed*0.4)
                let distFromRecord = Math.hypot((screenWidth - 15) - mouseX, (screenHeight - 15 + titleOffset) - mouseY)
                let angleToRecord = Math.atan2((screenHeight - 15 + titleOffset) - mouseY, (screenWidth - 15) - mouseX) * 0x8000 / Math.PI + 0x8000
                
                if (distFromRecord < TEX_MUSIC_RECORD.width * 0.5 && djui_hud_get_mouse_buttons_pressed() & L_MOUSE_BUTTON) {
                    recordHeld = true
                    recordDragStart = angleToRecord
                }
                if (distFromRecord > TEX_MUSIC_RECORD.width * 0.5 || djui_hud_get_mouse_buttons_released() & L_MOUSE_BUTTON) {
                    recordHeld = false
                }
                if (Math.abs(recordDragStart - angleToRecord) > 0x4000) {
                    recordDragStart = angleToRecord
                }
                if (recordHeld) {
                    recordSpeed *= 0.95
                    recordSpeed += (recordDragStart - angleToRecord) / 16
                    recordDragStart = angleToRecord
                } else {
                    if (recordSpeed > userSpeedTarget)
                        recordSpeed -= recordSlowDown
                    else if (recordSpeed < 0)
                        recordSpeed += recordBrake
                    else recordSpeed = Math.min(userSpeedTarget, recordSpeed + recordSpeedUp)
                }
                recordRot += recordSpeed

                if (recordSpeed > recordBreakThreshold) recordBreakTimer++
                else recordBreakTimer = 0

                SOUND_MUSIC.playbackRate = clamp(recordSpeed / recordSpeedTarget, 0.07, 16)
                if (recordSpeed / recordSpeedTarget < SOUND_MUSIC.playbackRate)
                    SOUND_MUSIC.pause()
                else SOUND_MUSIC.play()

                if (recordBreakTimer > 99) {
                    recordBroken = true
                    SOUND_MUSIC.pause()
                    SOUND_SHATTER.play()
                    recordVel.x = random(-5, 1)
                    recordVel.y = random(-7, -1)
                    musicTitleVel.x = random(-5, 1)
                    musicTitleVel.y = random(-7, -1)
                    musicArtistVel.x = random(-5, 2)
                    musicArtistVel.y = random(-7, -1)
                }
            } else {
                recordPos.x += recordVel.x
                recordPos.y += recordVel.y
                musicTitlePos.x += musicTitleVel.x
                musicTitlePos.y += musicTitleVel.y
                musicArtistPos.x += musicArtistVel.x
                musicArtistPos.y += musicArtistVel.y

                recordVel.y += 0.3
                musicTitleVel.y += 0.3
                musicArtistVel.y += 0.3
                
                recordRot += recordSpeed
                recordBreakSpin += recordSpeed * 0.03
            }

            djui_hud_set_color(255, 255, 255, 255)
            djui_hud_print_text(currMusicTrack.artist, screenWidth - (djui_hud_measure_text(currMusicTrack.artist)*0.3 + 50) * (1 - (titleOffset / (screenWidth * 0.25))) + musicArtistPos.x, screenHeight - 20 + musicArtistPos.y, 0.3)
            djui_hud_print_text(currMusicTrack.name, screenWidth - (djui_hud_measure_text(currMusicTrack.name)*0.3 + 50) * (1 - (titleOffset / (screenWidth * 0.25))) + musicTitlePos.x, screenHeight - 10 + musicTitlePos.y, 0.3)
            djui_hud_set_rotation(recordRot, 0.5, 0.5)
            djui_hud_render_texture(TEX_MUSIC_RECORD, screenWidth - TEX_MUSIC_RECORD.width*0.25 * Math.cos(recordBreakSpin) - 15 + recordPos.x + titleOffset, screenHeight - TEX_MUSIC_RECORD.height*0.25 - 15 + titleOffset + recordPos.y, 0.5 * Math.cos(recordBreakSpin), 0.5)
            djui_hud_set_rotation(0, 0, 0)
        } else {
            titleOffset = screenWidth*0.25
            if (globalTimer > 150) {
                djui_hud_set_color(255, 255, 255, Math.abs(Math.sin((globalTimer - 150)*0.05)/Math.PI)*255)
                djui_hud_print_text(TEXT_CLICK_ANYWHERE, screenWidth*0.5 - djui_hud_measure_text(TEXT_CLICK_ANYWHERE)*0.25, screenHeight - 30, 0.5)
                djui_hud_set_color(255, 255, 255, 255)
                djui_hud_print_text(konamiKeys.toString().replace(/,/g, ''), screenWidth*0.5 - djui_hud_measure_text(konamiKeys.join(""))*0.25, 30, 0.5)
            }
        }

        // if ('getBattery' in navigator) {
        // navigator.getBattery().then(function(battery) {
        //     console.log('Battery level: ' + (battery.level * 100) + '%');
        //     console.log('Is charging: ' + battery.charging);
        // });
        // } else {
        // console.log('Battery Status API not supported');
        // }


        // Show Time in Corner
        djui_hud_set_color(255, 255, 255, 255)
        const timeString = get_current_time_string()
        djui_hud_print_text(timeString, screenWidth - 3 - djui_hud_measure_text(timeString)*0.4, 3, 0.4)

        // Work In Progress Text
        // let headerScrollX = -Math.tan(globalTimer*0.02 - 1.1)*screenWidth/3 + screenWidth*0.5
        // djui_hud_set_color(0, 0, 0, 100)
        // djui_hud_render_rect(0, 10, screenWidth, 16)
        // djui_hud_set_color(255, 255, 255, 255)
        // djui_hud_print_text(TEXT_WIP, 20 + headerScrollX, 13, 0.5)

        // Global Site Timer
        globalTimer = globalTimer + 1
    }

    // Secrets
    window.addEventListener('keypress', (e) => {
        if (e.key == "Enter") {
            keyTitleClick = true
            return
        }
        konamiKeys.push(e.key)
    })

    hook_event(hud_render)

</script>
</html> 
